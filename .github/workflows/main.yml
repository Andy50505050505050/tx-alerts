name: Transaction Alerts
on:
  workflow_dispatch:
on:
  schedule:
    - cron: '*/5 * * * *' # This runs every 5 minutes (you can adjust this)

jobs:
  transaction_alerts:
    runs-on: ubuntu-latest
    steps:
      - name: Get transaction data from BscScan
        run: |
          # Set up environment variables for the BscScan API
          export API_KEY="J7ZWATDNC5H2JPCRU6AGVX7VHXUESWWSX5"
          export TOKEN_ADDRESS="0xA4b3445A58111ABD407C34402aB59B0FE05bFF5a"
          export BOT_TOKEN="${{ secrets.TELEGRAMBOTTOKEN }}"
          export CHAT_ID="-1002455751644"

          # Call the BscScan API
          RESPONSE=$(curl -s "https://api.bscscan.com/api?module=logs&action=getLogs&fromBlock=latest&toBlock=latest&address=$TOKEN_ADDRESS&apikey=$API_KEY")
          
          # Parse the response and send a Telegram message if new transactions are found
          echo "$RESPONSE" | jq -r '.result[] | "From: \(.from), To: \(.to), Value: \(.value), Tx Hash: https://bscscan.com/tx/\(.transactionHash)"' |
            while read transaction; do
              curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
                -d "chat_id=$CHAT_ID" \
                -d "text=$transaction"
            done
