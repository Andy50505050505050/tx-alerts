name: Transaction Alerts
on:
  workflow_dispatch:
  schedule:
    - cron: '*/5 * * * *' # Runs every 5 minutes

jobs:
  transaction_alerts:
    runs-on: ubuntu-latest
    steps:
      - name: Get transaction data from BscScan
        run: |
          # Set up environment variables
          export API_KEY="J7ZWATDNC5H2JPCRU6AGVX7VHXUESWWSX5"
          export TOKEN_ADDRESS="0xAd52f33f9Fc4DE396f2e8236438e9c590680B54B"
          export BOT_TOKEN="${{ secrets.TELEGRAMBOTTOKEN }}"
          export CHAT_ID="-1002455751644"

          # Fetch the last two transactions
          RESPONSE=$(curl -s "https://api.bscscan.com/api?module=logs&action=getLogs&fromBlock=latest&toBlock=latest&address=$TOKEN_ADDRESS&apikey=$API_KEY")

          # Validate and parse the response
          if [ "$(echo "$RESPONSE" | jq -r '.status')" == "1" ]; then
            echo "$RESPONSE" | jq -r '.result[:2] | .[] | "ğŸš€ *ElonXCat Live Transaction Alert* ğŸš€\n\nğŸ—“ï¸ *Date & Time:* \(.timeStamp | tonumber | strftime("%Y-%m-%d %H:%M:%S"))\nğŸ“¤ *From:* \(.from)\nğŸ“¥ *To:* \(.to)\nğŸ’° *Amount:* \(.value | tonumber / 10^18) BNB (~$ \((.value | tonumber / 10^18) * 300))\nğŸ”— [View on BscScan](https://bscscan.com/tx/\(.transactionHash))\n---"' | while read transaction; do
              curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
                -d "chat_id=$CHAT_ID" \
                -d "parse_mode=Markdown" \
                -d "text=$transaction"
            done
          else
            echo "No valid transactions found or an error occurred: $RESPONSE"
          fi
