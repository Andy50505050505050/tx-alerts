name: Transaction Alerts
on:
  workflow_dispatch:
  schedule:
    - cron: '*/5 * * * *' # Run every 5 minutes

jobs:
  transaction_alerts:
    runs-on: ubuntu-latest
    steps:
      - name: Get transaction data from BscScan
        run: |
          export API_KEY="J7ZWATDNC5H2JPCRU6AGVX7VHXUESWWSX5"
          export TOKEN_ADDRESS="0xA4b3445A58111ABD407C34402aB59B0FE05bFF5a"
          export BOT_TOKEN="${{ secrets.TELEGRAMBOTTOKEN }}"
          export CHAT_ID="-1002455751644"

          # Fetch transaction logs
          RESPONSE=$(curl -s "https://api.bscscan.com/api?module=logs&action=getLogs&fromBlock=0&toBlock=latest&address=$TOKEN_ADDRESS&apikey=$API_KEY")
          
          # Parse the last 10 transactions
          echo "$RESPONSE" | jq -r '.result[-10:] | .[] | "From: \(.from), To: \(.to), Value: \(.value), Tx Hash: https://bscscan.com/tx/\(.transactionHash)"' > transactions.txt

          # Send each transaction to Telegram
          while read -r transaction; do
            curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
              -d "chat_id=$CHAT_ID" \
              -d "text=$transaction"
          done < transactions.txt
